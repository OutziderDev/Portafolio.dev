---
import { Image } from 'astro:assets';
const icons = import.meta.glob("../assets/icons/*.svg", {eager: true})
const {titulo,descripcionCard,thumb,stack,estado,type,fecha,slug,categoria} = Astro.props 

const filteredIcons = Object.entries(icons)
.filter(([path]) => {
  const lastSegment = path.split("/").pop()
  return stack.includes((lastSegment ?? "").replace(".svg", ""))})
.map(([, mod]) => (mod as {default:any}).default)
---

<div data-slug={slug} role="link" class='proyecto-card border border-white/30 cursor-pointer bg-primary rounded-2xl hover:scale-[1.02] overflow-hidden  relative transition-transform duration-200'>
  <div class="grid lg:grid-cols-2 lg:gap-16 bg-black p-4 rounded-2xl overflow-hidden">
    <div class="pb-4">
      <div class="text-sky-400/80  font-bold font-Mukta text-md">
        <span>{type} - {fecha}</span>
      </div>

      <h3 class="text-3xl font-bold md:text-4xl font-Montserrat mt-2">
        {titulo}
      </h3>
      <div class="flex gap-2 w-full font-Mukta">
        {
          estado ? '' : <div class="px-4 py-1 my-3 text-sm bg-yellow-400  rounded-3xl text-black font-bold">En Curso</div>
        }
        {categoria.map((cat : String) =>  
          <div class="px-4 py-1 my-3 flex items-center text-sm justify-center text-pretty bg-white rounded-3xl text-black font-semibold">{cat === "Desarrollo" ? `💻 Desarrollo` : `🖌️ Diseño UX/UI`}</div>
          )
        }      
      </div>
      <p class="border-t border-white/80 mt-2 py-4 font-Mukta text-wrap text-white/80">
        {descripcionCard}
      </p>

      <div class="flex gap-4 border-t border-white/90 py-4 -mb-4">
        {
          filteredIcons.map((Icon) => {
            return <Icon class="size-7 fill-white"/>
          })
        }
      </div>

    </div>

    <div class="relative">
      <Image
        width={1200}
        height={900}
        class="mt-8 -mb-4 rounded-t-2xl object-cover  lg:max-w-lg lg:absolute  lg:h-full  lg:hover:scale-102 delay-200 transition"
        src=`/${thumb}`
        alt="Preview del proyecto"
      />
    </div>
  </div>
</div>


<script >
  document.addEventListener("DOMContentLoaded", () => {
    const contenedores = document.querySelectorAll(".proyecto-card")
    if (contenedores) {
      contenedores.forEach( (contenedor )  => {
        contenedor.addEventListener('click', () => {
          const div = contenedor as HTMLElement
          const slug = div.dataset.slug
          window.location.href= `/proyectos/${slug}`
        })
      })
    }
  })
</script>

<style>
  
 

</style>
